<app-header></app-header>
<div class="container" style="margin-top: 8%;">
  <h4 class="text-center mb-4 text-decoration-underline text-danger">Parcel Delivery</h4>
  <div class="section-border">
    <form (ngSubmit)="searchUser()">
      <div class="row g-3 align-items-center">
        <div class="col-md-4">
          <label for="searchBy" class="form-label">Search By:</label>
          <select class="form-select" id="searchBy">
            <option>GRN No/LR No/Serial No</option>
          </select>
        </div>
        <div class="col-md-4">
          <label for="searchInput" class="form-label">Search:</label>
          <input
            required
            type="text"
            id="searchTerm"
            name="searchTerm"
            placeholder="Enter GRN Number"
            class="form-control"
            [(ngModel)]="searchTerm"
          />
        </div>

        <div class="col-md-4 mt-5 d-flex flex-column gap-2" *ngIf="data2 && data2.length > 0">
          <h2 class="text-center">Parcel Status</h2>

          <ng-container [ngSwitch]="data2[0]?.bookingStatus">
            <h2 class="text-success text-center" *ngSwitchCase="0">Parcel Booked</h2>
            <h2 class="text-success text-center" *ngSwitchCase="1">Parcel Loaded</h2>
            <h2 class="text-success text-center" *ngSwitchCase="2">Parcel UnLoaded</h2>
            <h2 class="text-success text-center" *ngSwitchCase="3">Parcel Missing</h2>
            <h2 class="text-success text-center" *ngSwitchCase="4">Already Delivered</h2>
            <h2 class="text-success text-center" *ngSwitchCase="5">Parcel Cancel</h2>
            <h2 class="text-warning text-center" *ngSwitchDefault>Status Unknown</h2>
          </ng-container>
        </div>
      </div>

      <div class="text-center mt-3">
        <button class="btn ms-auto" style="background-color: #034F92; color: white;" type="submit">
          LOAD
        </button>
      </div>
    </form>

    <!-- Delivery Form when status is Unloaded -->
    <div *ngIf="data2?.[0]?.bookingStatus === 2" class="mt-2">
      <div class="col-12 mb-3">
        <h4 class="section-title text-center text-danger">Delivery Details</h4>
      </div>

      <form [formGroup]="form2">
        <div class="row">
          <input type="hidden" formControlName="grnNo" [ngModel]="data2[0]?.grnNo" />

          <div class="col-md-4 mb-3">
            <label for="receiverName1" class="form-label">Delivery Receiver Name</label>
            <input
              type="text"
              class="form-control"
              id="receiverName1"
              formControlName="receiverName1"
              placeholder="Enter receiver name"
            />
          </div>

          <div class="col-md-4 mb-3">
            <label for="receiverMobile1" class="form-label">Delivery Receiver Phone</label>
            <input
              type="text"
              class="form-control"
              id="receiverMobile1"
              formControlName="receiverMobile1"
              placeholder="Enter receiver phone"
            />
          </div>

          <div class="col-md-2 d-flex align-items-end mb-3">
            <button type="button" class="btn btn-success btn-lg w-100" (click)="updateParcelStatus()">
              Submit
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Total and Paid Type Summary -->
    <div *ngIf="data2 && data2.length > 0">
      <div class="row mb-2">
        <div class="col-md-4">
          <label class="form-label">Total Price</label>
          <input type="text" class="form-control" [value]="data2[0]?.grandTotal" readonly />
        </div>
        <div class="col-md-4">
          <label class="form-label">Paid Type</label>
          <input type="text" class="form-control" [value]="data2[0]?.bookingType" readonly />
        </div>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="text-danger mt-3">
    {{ errorMessage }}
  </div>

  <!-- Form Table Section -->
  <div class="section-border" *ngIf="data2 && data2.length > 0">
    <div class="row g-3" *ngFor="let items of data2">
      <div class="col-md-4">
        <label class="form-label">GRN No/LR No</label>
        <input type="text" class="form-control" [value]="items?.grnNo" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Sender Name</label>
        <input type="text" class="form-control" [value]="items?.senderName" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Sender Phone</label>
        <input type="text" class="form-control" [value]="items?.senderMobile" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Receiver Name</label>
        <input type="text" class="form-control" [value]="items?.receiverName" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Receiver Phone</label>
        <input type="text" class="form-control" [value]="items?.receiverMobile" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">From City</label>
        <input type="text" class="form-control" [value]="items?.fromCity" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">To City</label>
        <input type="text" class="form-control" [value]="items?.toCity" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">From Branch</label>
        <input type="text" class="form-control" [value]="items?.pickUpBranchname" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">To Branch</label>
        <input type="text" class="form-control" [value]="items?.dropBranchname" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Booked By Branch</label>
        <input type="text" class="form-control" [value]="items?.pickUpBranchname" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Booked By User</label>
        <input type="text" class="form-control" [value]="items?.bookedBy?.name" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Booking Date</label>
        <input type="text" class="form-control" [value]="items?.bookingDate" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Loading Date</label>
        <input type="text" class="form-control" [value]="items?.loadingDate" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Unloading Date</label>
        <input type="text" class="form-control" [value]="items?.unloadingDate" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Delivery Date</label>
        <input type="text" class="form-control" [value]="items?.deliveryDate" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Load By User</label>
        <input type="text" class="form-control" [value]="items?.loadingByemp" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Unload By User</label>
        <input type="text" class="form-control" [value]="items?.unloadingByemp" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Delivered By User</label>
        <input type="text" class="form-control" [value]="items?.deliveryEmployee" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Booking Status</label>
        <input type="text" class="form-control" [value]="items?.bookingStatus" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Parcel Quantity</label>
        <input type="text" class="form-control" [value]="items?.totalQuantity" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Total Price</label>
        <input type="text" class="form-control" [value]="items?.grandTotal" readonly />
      </div>
      <div class="col-md-4">
        <label class="form-label">Paid Type</label>
        <input type="text" class="form-control" [value]="items?.bookingType" readonly />
      </div>
    </div>
  </div>
</div>
